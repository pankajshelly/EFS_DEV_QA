

<div class="divWidth"> 
    <div id="divTransactionType">
        <div class="verticalCSSDestopTISForLables lblCSS">
            <span id="lblTransactionType">Transaction Type</span>
        </div>
        <div class="verticalCSSDestopTIS DDLCSS">
            @Html.DropDownList("lstTransTypeNonItemWeeklyExp", ViewData["lstTransTypeNonItemWeeklyExp"] as SelectList, new { @class = "spanMobileWidth", aria_labelledby = "lblTransactionType" })
        </div>
        <div class="verticalCSSDestopTIS DDLCSS">
            <input type="button" id="btnAddNewTransaction" class="btn btn-default clsSetPreserences ui-button ui-widget ui-state-default ui-corner-all" name="Command" value="Add New Transaction" title="Add New Transaction" style="font-size:12px; text-decoration:none;" />
        </div>
    </div>
    <div id="divSortColumns" style="clear:both;">
        <div class="verticalCSSDestopTISForLables lblCSS" style="clear:both;">
            <span id="lblColumnName">Sort</span>
        </div>
        <div class="verticalCSSDestopTIS DDLCSS">
            @Html.DropDownList("lstSortColumnName", ViewData["lstSortColumnName"] as SelectList, new { @class = "spanMobileWidth", aria_labelledby = "lblColumnName" })
        </div>
        <div class="verticalCSSDestopTIS DDLCSS">
            @Html.DropDownList("lstSortColumnNameOrder", ViewData["lstSortColumnNameOrder"] as SelectList, new { @class = "spanMobileWidth", aria_labelledby = "lblColumnName" })
        </div>
    </div>
    <div id="divViewableColumn" style="clear:both;">
        <div class="verticalCSSDestopTISForLables lblCSS">
            <span id="lblColumns">Select columns to view</span>
        </div>
        <div class="verticalCSSDestopTIS DDLCSS">
            @Html.DropDownList("ddlViewableColumn", ViewData["lstSortColumnName"] as SelectList, new { @class = "spanMobileWidth", multiple = "multiple", aria_labelledby = "lblColumns" })
        </div>
        <div class="verticalCSSDestopTIS DDLCSS" style="padding-bottom:2em;">
            <input type="button" id="btnSetPreferences" class="btn btn-default clsSetPreserences ui-button ui-widget ui-state-default ui-corner-all" name="Command" value="Set Preferences" title="Set Preferences" style="font-size:12px;" />
        </div>
    </div>
</div>
<div class="submitTransBtnCls">
    <input type="button" id="btnSubmitSchedAIEWeeklyContr" class="btn btn-default clsSetPreserences ui-button ui-widget ui-state-default ui-corner-all" name="Command" value="Submit Transaction" title="Submit Transaction" style="font-size:12px;" />
    <b>Select on un-submitted transaction in grid to enable "Submit Transaction" button</b>
</div>
<div id="dvMonetaryAllocAmt" class="floatLeft paddingIEWeeklyContrTxt">
    <h3 id="lblAllTransTextIEWeeklyContr" style="font-weight:bolder">All Transactions</h3>
</div>
<div id="divGrid_gridFilingTransIEWeeklyLiabilityIncurred">
    <table id="gridFilingTransIEWeeklyLiabilityIncurred" class="table-bordered display nowrap" style="width:100%; border-spacing: 0px;">
        <thead id="thdGrid" class="header">
            <tr>
                <th class="never">FilingTransId</th> @* 0 *@
                <th class="never">FilingSchedId</th> @* 1 *@
                <th class="never">FilingEntityId</th> @* 2 *@
                <th class="never">PurposeCodeId</th> @* 3 *@
                <th class="never">PaymentTypeId</th> @* 4 *@
                <th class="never">AddrId</th> @* 5 *@
                <th class="never">TreasId</th> @* 6 *@
                <th>Expand</th> @* 7 *@
                <th>Action</th> @* 8 *@
                <th>Submission Date</th> @* 9 *@
                <th>Entity Name</th> @* 10 *@
                <th>Original Amount $</th> @* 11 *@
                <th>Outstanding Amount $</th> @* 12 *@
                <th>Status</th> @* 13 *@
                <th>Amended</th> @* 14 *@
                <th>Transaction Date</th> @* 15 *@
                <th>Transaction Type</th> @* 16 *@
                <th>Purpose Code</th> @* 17 *@
                <th>Country</th> @* 18 *@
                <th>Street Address</th> @* 19 *@
                <th>City</th> @* 20 *@
                <th>State</th> @* 21 *@
                <th>Zip Code</th> @* 22 *@
                <th>Method</th> @* 23 *@
                <th>Check #</th> @* 24 *@
                <th>Explanation</th> @* 25*@
                <th>Itemized</th> @* 26 *@
                <th>Treasurer First Name</th> @* 27 *@
                <th>Treasurer Last Name</th> @* 28 *@
                <th>Treasurer Middle Name</th> @* 29 *@
                <th>Treasurer Occupation</th> @* 30 *@
                <th>Treasurer Employer</th> @* 31 *@
                <th>Treasurer Street Address</th> @* 32 *@
                <th>Treasurer City</th> @* 33 *@
                <th>Treasurer State</th> @* 34 *@
                <th>Treasurer Zip Code</th> @* 35 *@
                <th>Creditor Occupation</th> @* 36 *@
                <th>Creditor Employer</th> @* 37 *@
                <th>Independent Expenditure Description</th> @* 38 *@
                <th>Candidate's Name/Ballot Proposal Reference</th> @* 39 *@
                <th>Supported</th> @* 40 *@
                <th>Created Date</th> @* 41 *@
                <th class="never">LoanLiabilityNumber</th> @* 42 *@
                <th class="never">TransNumber</th> @* 43 *@
                <th class="never">TransMapping</th> @* 44 *@
                <th class="never">CreatedDate24H</th> @* 45 *@
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    $m = jQuery.noConflict();

    $('#menuNav').css('opacity', 0);
    $('#submitForm').css('opacity', 0);
    $(window).on('load', function () {
        $('#menuNav').css('opacity', 1);
        $('#submitForm').css('opacity', 1);
    });

    /**
     * A common function that can be used anywhere this table is implemented.
     * Needs to exist outside the $m(document).ready function in order to be accessed but other files.
     * @@param results - A list of column table headers to unhide. 
     * @@param { DataTables.Api DataTable } tableReferece - These can be provided via $m('#' + gridName).DataTable() which returns a DataTables API instance and should not to be confused with $m('#' + gridName).dataTable() which returns a jQuery Object.
     */
    function GridCommonNIIEWeeklyLiabilityIncurred_HideColumn(results, tableReferece) {
        var rules = {
            "indexesToStartHidden": [0, 1, 2, 3, 4, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45],
            "indexesToAlwaysKeepUnhidden": [7, 8], //Will always unhide.
            "columnNamesToUnhide": results,//String to match.
            "columnNamesIndexMappings": [
                ['Submission Date', 9],
                ['Entity Name', 10],
                ['Original Amount', 11],
                ['Outstanding Amount', 12],
                ['Status', 13],
                ['Amend', 14],
                ['Transaction Date', 15],
                ['Transaction Type', 16],
                ['Purpose Code', 17],
                ['Country', 18],
                ['Street Address', 19],
                ['City', 20],
                ['State', 21],
                ['Zip Code', 22],
                ['Method', 23],
                ['Check', 24],
                ['Explanation', 25],
                ['Itemized', 26],
                ['Treasurer First Name', 27],
                ['Treasurer Last Name', 28],
                ['Treasurer Middle Name', 29],
                ['Treasurer Occupation', 30],
                ['Treasurer Employer', 31],
                ['Treasurer Street Address', 32],
                ['Treasurer City', 33],
                ['Treasurer State', 34],
                ['Treasurer Zip Code', 35],
                ['Creditor Occupation', 36],
                ['Creditor Employer', 37],
                ['Independent Expenditure Description', 38],
                ["Candidate's Name / Ballot Proposal Reference", 39],
                ['Supported', 40],
                ['Created Date', 41]]//String in header, index to unhide
        }
        appCommonEFS_HideTableColumn(tableReferece, rules);
    }

    $m(document).ready(function () {
        $('#lstTransactionTypeNonItem').val(sessionStorage.getItem("lstTransactionTypeNonItem").toString());
        $('#lstTransactionTypeNonItem').focus();
        $("#lstSortColumnName")[0].selectedIndex = 10; // Created Date by Default Value in Sort Dropdown.
        $("#lstSortColumnNameOrder")[0].selectedIndex = 1;

        $m('#ddlViewableColumn').multipleSelect({
            styler: function (value) {
                return 'padding-left: 0.2em;';
            },
            width: '100%',
            placeholder: "Select columns to view",
            filter: true
        });

        var options = {};
        options.url = "@Url.Content("~/_UC_GridCommonControl/GetColumns/")";
        options.type = "POST";
        options.data = JSON.stringify(
            {
                uniqudId: '',
                applicationName: '',
                pageName: ''
            });
        options.dataType = "json";
        options.contentType = "application/json";
        options.success = function (data) {
            var val = '';
            for (var i = 0; i < data.length; i++) {
                if (i == (data.length - 1)) {

                    val += parseFloat(data[i].Value);
                    break;
                }
                else {
                    val += parseFloat(data[i].Value) + ',';
                }
            }

            var resultArray = val.split(',').map(function (val) { return Number(val); });
            $m("#ddlViewableColumn").multipleSelect("setSelects", resultArray);
            
            $m('#ddlViewableColumn option:contains("Submission Date")').attr("disabled", "disabled");
            $m('#ddlViewableColumn option:contains("Entity Name")').attr("disabled", "disabled");            
            $m('#ddlViewableColumn option:contains("Transaction Date")').attr("disabled", "disabled");
            $m('#ddlViewableColumn option:contains("Transaction Type")').attr("disabled", "disabled");
            $m('#ddlViewableColumn option:contains("Original Amount")').each(function () {
                if ($(this).text() == 'Original Amount') {
                    $(this).attr('disabled', 'disabled');
                    return false;
                }
                return true;
            });

            $m('#ddlViewableColumn').multipleSelect('checkAll');

            $m("#ddlViewableColumn").multipleSelect("refresh");

            $m('#ddlViewableColumn').multipleSelect('checkAll');

            var selectedValuesArray = [];

            // CALL VIEWABLE COLUMN METHOD AND SET THE SELECTED CHECK BOX BASED ON FROM DATABASE VALUE 'Y' OR 'N'
            // SO THAT BY DEFAULT IT WON'T SELECT ALL CHECK BOXES IN MULTISELECT CONTROL.
            $.post("@Url.Content("~/_UC_GridCommonNIIEWeeklyLiabilityIncurred/GetColumnUpdatedValueIEWeeklyLiabIncrr/")", {uniqudId: @Session["FilerID"].ToString()}, function (results) {
                $.each(results, function (i, item) {
                    if (item.Viewable.toString() == "Y") {
                        selectedValuesArray[i] = parseInt(item.ViewableFieldID.toString());
                    }
                });
                $m('#ddlViewableColumn').multipleSelect('setSelects', selectedValuesArray);
            });
        };
        options.error = function () {
            alert("Error Fetching Data. Please Contact NYS Board of Elections ◾(518) 474-8200 ");
        };
        $.ajax(options);

        var tableFilingTransactions = '';

        $("#lstSortColumnName,#lstSortColumnNameOrder").change(function (e) {
            var data_table = $m('#gridFilingTransIEWeeklyLiabilityIncurred').DataTable();
            var sortCount = '';

            if ($("#lstSortColumnName option:selected").text() == "Submission Date") {
                sortCount = 9;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Entity Name") {
                sortCount = 10;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Original Amount") {
                sortCount = 11;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Outstanding Amount") {
                sortCount = 12;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Status") {
                sortCount = 13;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Amend") {
                sortCount = 14;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Transaction Date") {
                sortCount = 15;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Transaction Type") {
                sortCount = 16;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Purpose Code") {
                sortCount = 17;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Country") {
                sortCount = 18;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Street Address") {
                sortCount = 19;
            }
            else if ($("#lstSortColumnName option:selected").text() == "City") {
                sortCount = 20;
            }
            else if ($("#lstSortColumnName option:selected").text() == "State") {
                sortCount = 21;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Zip Code") {
                sortCount = 22;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Method") {
                sortCount = 23;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Check") {
                sortCount = 24;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Explanation") {
                sortCount = 25;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Itemized") {
                sortCount = 26;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer First Name") {
                sortCount = 27;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer Last Name") {
                sortCount = 28;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer Middle Name") {
                sortCount = 29;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer Occupation") {
                sortCount = 30;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer Employer") {
                sortCount = 31;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer Street Address") {
                sortCount = 32;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer City") {
                sortCount = 33;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer State") {
                sortCount = 34;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Treasurer Zip Code") {
                sortCount = 35;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Creditor Occupation") {
                sortCount = 36;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Creditor Employer") {
                sortCount = 37;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Independent Expenditure Description") {
                sortCount = 38;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Candidate's Name/Ballot Proposal Reference") {
                sortCount = 39;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Supported") {
                sortCount = 40;
            }
            else if ($("#lstSortColumnName option:selected").text() == "Created Date") {
                sortCount = 41;
            }
            data_table.order([sortCount, $("#lstSortColumnNameOrder option:selected").val()]).draw();
        });

        // Transaction Type
        $("#lstTransTypeNonItemWeeklyExp").change(function () {
            var selectedlstTransactionTypeNonItem = $("#lstTransactionTypeNonItem option:selected").val().toString();
            sessionStorage.setItem("lstTransactionTypeNonItem", $("#lstTransactionTypeNonItem option:selected").val());
            sessionStorage.setItem("FilerId", $("#txtFilerID option:selected").val());
            sessionStorage.setItem("CommitteeName", $("#txtCommitteeName option:selected").val());
            sessionStorage.setItem("ElectionCycle", $("#lstElectionCycle option:selected").val());
            sessionStorage.setItem("OfficeType", $("#lstUCOfficeType option:selected").val());
            sessionStorage.setItem("County", $("#lstUCCounty option:selected").val());
            sessionStorage.setItem("Municipality", $("#lstUCMuncipality option:selected").val());
            sessionStorage.setItem("ElectionType", $("#lstElectionType option:selected").val());
            sessionStorage.setItem("ElectionDate", $("#lstElectionDate option:selected").val());
            sessionStorage.setItem("DisclosureType", $("#lstDisclosureType option:selected").val());
            sessionStorage.setItem("DisclosurePeriod", $("#lstDisclosurePeriod option:selected").val());
            sessionStorage.setItem("DisclosurePeriodText", $("#lstDisclosurePeriod option:selected").text());
            sessionStorage.setItem("DisclosureTypeText", $("#lstDisclosureType option:selected").text());
            sessionStorage.setItem("ElectionCycleText", $("#lstElectionCycle option:selected").text());

            //HideUserControl();
            $("#lstTransactionTypeNonItem").show();

            if (selectedlstTransactionTypeNonItem == "14") { // SCHEDULE - F
                $("#lblHeader,#lblHeader1,#lblHeader2").text("Outstanding Liabilities/Loans");
                var urlContributionsCandIndFamily = "@Url.Content("~/NonItemIEWeeklyLiabilityIncurredSchedN/NonItemIEWeeklyLiabilityIncurredSchedN/")";
                window.location.href = urlContributionsCandIndFamily;
            }
        });

        //Bind Clear Click
        $(".clsCommonClear").bind('click', function () {
            $("#divGridMonetary").show();
            sessionStorage.setDataTable = "true";
            $("#divShowHideHelp").removeClass("clsShowHideHelpSec");
            $("#divShowHideHelp").addClass("clsShowHideHelpSecInMobileTablet");

            sessionStorage.setItem("FilerId", $("#txtFilerID option:selected").val());
            sessionStorage.setItem("CommitteeName", $("#txtCommitteeName option:selected").val());
            sessionStorage.setItem("ElectionCycle", $("#lstElectionCycle option:selected").val());
            sessionStorage.setItem("ElectionType", $("#lstElectionType option:selected").val());
            sessionStorage.setItem("ElectionDate", $("#lstElectionDate option:selected").val());
            sessionStorage.setItem("DisclosureType", $("#lstDisclosureType option:selected").val());
            sessionStorage.setItem("DisclosurePeriod", $("#lstDisclosurePeriod option:selected").val());
            sessionStorage.setItem("TransactionType", $("#lstTransactionTypeNonItem option:selected").val());
            sessionStorage.setItem("TransactionTypeId", "true");

            var urlContrHome = "@Url.Content("~/ContributionsMonetary/ContributionsMonetary/")"; 
            window.location.href = urlContrHome;
        });

    });
</script>